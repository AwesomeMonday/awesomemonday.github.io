I"æ8<p>Hello, this is Hao.</p>

<p>Word cloud doesnâ€™t provide much of statistical meaning itself. But it is great for text comparisons and itâ€™s very fun to look at. So today, I will make a wordcloud about what the customers say about one of the top rated Asian restaurants in the New York city area.</p>

<p>This is for exploratory purposes only, the reason I picked this restaurant is simply because the amount of reviews is large enough to be statistical significant, but not too large to be picked up by anti scraping bot from the website, in order to block my IP address.</p>

<p>This is the second part of the web scraping project I am working on, for details about the first part on how to scrap website, please click <a href="https://awesomemonday.github.io/2022/05/03/NYC-Asian-Restaurant.html">here</a>}</p>

<p>I will use the these 2 R packages for this, if you donâ€™t have them installed, you can run the following code.</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="s2">"wordcloud2"</span><span class="p">)</span><span class="w">
</span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"tm"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p>load in libraries</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">wordcloud2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tm</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">rvest</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">lubridate</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>There are a total of 48 pages of reviews,</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rm</span><span class="p">(</span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ls</span><span class="p">())</span><span class="w">

</span><span class="n">date_all</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">  </span><span class="nf">c</span><span class="p">()</span><span class="w">
</span><span class="n">rating_all</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">()</span><span class="w">
</span><span class="n">user_location_all</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">()</span><span class="w">
</span><span class="n">review_text_all</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">()</span><span class="w">

</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">page_num</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="m">48</span><span class="o">*</span><span class="m">10</span><span class="p">)</span><span class="m">-10</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">)){</span><span class="w">
  </span><span class="n">url</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"https://www.yelp.com/biz/blue-willow-%E5%A4%9C%E6%9D%A5%E6%B9%98-new-york-2?start="</span><span class="p">,</span><span class="w"> </span><span class="n">page_num</span><span class="p">)</span><span class="w">
  
  </span><span class="n">page</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_html</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="w">

  </span><span class="n">date</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">html_nodes</span><span class="p">(</span><span class="s2">".margin-b1-5__09f24__NHcQi .css-chan6m"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">html_text2</span><span class="p">()</span><span class="w">

  </span><span class="n">user_location</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">html_nodes</span><span class="p">(</span><span class="s2">".arrange-unit-fill__09f24__CUubG .border-color--default__09f24__NPAKY .border-color--default__09f24__NPAKY .border-color--default__09f24__NPAKY .border-color--default__09f24__NPAKY .css-qgunke"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">html_text2</span><span class="p">()</span><span class="w">
  
  </span><span class="n">rating</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">html_elements</span><span class="p">(</span><span class="n">xpath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"//div[contains(@aria-label, 'rating')]"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">html_attr</span><span class="p">(</span><span class="s2">"aria-label"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">str_remove_all</span><span class="p">(</span><span class="s2">" star rating"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="nf">as.numeric</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">tail</span><span class="p">(</span><span class="m">-1</span><span class="p">)</span><span class="w">
  
  </span><span class="n">review_text</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">html_nodes</span><span class="p">(</span><span class="s2">".css-qgunke .raw__09f24__T4Ezm"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">html_text2</span><span class="p">()</span><span class="w">
  
  </span><span class="n">date_all</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">append</span><span class="p">(</span><span class="n">date_all</span><span class="p">,</span><span class="w"> </span><span class="n">date</span><span class="p">)</span><span class="w">
  </span><span class="n">rating_all</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">append</span><span class="p">(</span><span class="n">rating_all</span><span class="p">,</span><span class="w"> </span><span class="n">rating</span><span class="p">)</span><span class="w">
  </span><span class="n">user_location_all</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">append</span><span class="p">(</span><span class="n">user_location_all</span><span class="p">,</span><span class="w"> </span><span class="n">user_location</span><span class="p">)</span><span class="w">
  </span><span class="n">review_text_all</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">append</span><span class="p">(</span><span class="n">review_text_all</span><span class="p">,</span><span class="w"> </span><span class="n">review_text</span><span class="p">)</span><span class="w">
  
  </span><span class="n">print</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="s2">"page"</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">page_num</span><span class="m">+10</span><span class="p">)</span><span class="o">/</span><span class="m">10</span><span class="p">))</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="s2">"taking a break"</span><span class="p">)</span><span class="w">
  
  </span><span class="n">Sys.sleep</span><span class="p">(</span><span class="m">5</span><span class="p">)</span><span class="w">
  
</span><span class="p">}</span><span class="w">

</span><span class="n">str</span><span class="p">(</span><span class="n">date_all</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">review_text_all</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">user_location_all</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">rating_all</span><span class="p">)</span><span class="w">
</span><span class="n">reviews</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tibble</span><span class="p">(</span><span class="s2">"date"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">head</span><span class="p">(</span><span class="n">date_all</span><span class="p">,</span><span class="w"> </span><span class="m">453</span><span class="p">),</span><span class="w">
                  </span><span class="s2">"rating"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">head</span><span class="p">(</span><span class="n">rating_all</span><span class="p">,</span><span class="w"> </span><span class="m">453</span><span class="p">),</span><span class="w">
                  </span><span class="s2">"user_location"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">head</span><span class="p">(</span><span class="n">user_location_all</span><span class="p">,</span><span class="w"> </span><span class="m">453</span><span class="p">),</span><span class="w">
                  </span><span class="s2">"review_text"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">head</span><span class="p">(</span><span class="n">review_text_all</span><span class="p">,</span><span class="w"> </span><span class="m">453</span><span class="p">))</span><span class="w">

</span><span class="n">View</span><span class="p">(</span><span class="n">reviews</span><span class="p">)</span><span class="w">

</span><span class="n">reviews</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">reviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mdy</span><span class="p">(</span><span class="n">date</span><span class="p">))</span><span class="w"> 

</span><span class="n">reviews</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">reviews</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">user_location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">str_sub</span><span class="p">(</span><span class="n">user_location</span><span class="p">,</span><span class="w"> </span><span class="m">-2</span><span class="p">))</span><span class="w"> 

</span><span class="n">reviews</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">reviews</span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">user_location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">toupper</span><span class="p">(</span><span class="n">user_location</span><span class="p">))</span><span class="w">


</span><span class="n">write_csv</span><span class="p">(</span><span class="n">reviews</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"C://Users//haoli//Desktop//restaurant_review.csv"</span><span class="p">)</span><span class="w">

</span></code></pre></div></div>

<pre><code class="language-{r}">review_corpus &lt;- Corpus(VectorSource(reviews$review_text))

review_corpus &lt;- review_corpus %&gt;% 
  tm_map(removeNumbers) %&gt;% 
  tm_map(removePunctuation) %&gt;% 
  tm_map(stripWhitespace) %&gt;% 
  tm_map(content_transformer(tolower)) %&gt;% 
  tm_map(removeWords, stopwords("english")) %&gt;% 
  tm_map(removeWords, stopwords("SMART")) %&gt;% 
  tm_map(removeWords, c("blue", "willow", "good", "great", "restaurant", "dish", "chinese", "place", "ordered"))

tdm &lt;- TermDocumentMatrix(review_corpus) %&gt;% 
  as.matrix()

words &lt;- sort(rowSums(tdm), decreasing = TRUE)

df &lt;- data.frame(word = names(words), freq = words)

wordcloud2(df)

?tm_map
</code></pre>

:ET